@model PitStop_Parts_Inventario.Models.ViewModels.PagedResult<PitStop_Parts_Inventario.Models.ProveedorModel>

@{
    ViewData["Title"] = "Proveedores";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="~/assets/css/proveedores.css" asp-append-version="true" />
}

<div class="container-fluid">
    <!-- Header Section -->
    <section class="header">
        <div class="row align-items-center mb-4">
            <div class="col-md-8">
                <h2 class="header-title">Proveedor</h2>
                <p class="text-muted header-subtitle">Página de gestión de proveedores</p>
            </div>
        </div>
    </section>

    <!-- Search and Actions Section -->
    <section class="search-actions-section">
        <div class="search-actions-container">
            @{
                var filtroNombre = "";
                if (Context.Request.Query.ContainsKey("filtros.Nombre"))
                {
                    filtroNombre = Context.Request.Query["filtros.Nombre"];
                }
            }

            <form asp-action="Index" method="get" class="search-wrapper">
                <div class="search-container">
                    <input type="text" name="filtros.Nombre" value="@filtroNombre"
                           class="form-control search-input" placeholder="Buscar proveedor..." />
                    <button type="submit" class="btn btn-link search-icon" title="Buscar proveedor">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </form>



            <div class="actions-wrapper">
                <button type="button" class="btn btn-crear" data-bs-toggle="modal" data-bs-target="#nuevoProveedorModal">
                    <i class="fas fa-plus"></i> Crear
                </button>
            </div>


            <div class="modal fade" id="nuevoProveedorModal" tabindex="-1" aria-labelledby="nuevoProveedorModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-centered">
                    <div class="modal-content" style="background:#232323; color:white; border-radius:8px; ">
                        <div class="modal-header border-0">
                            <h2 class="modal-title w-100 text-center fw-bold" id="nuevoProveedorModalLabel" style="font-size:2.3rem;">Nuevo Proveedor</h2>
                        </div>
                        <div class="modal-body">
                            <form>
                                <div class="row mb-3">
                                    <div class="col-md-6 mb-3 mb-md-0">
                                        <label for="nombre" class="form-label" style="font-size:1.3rem;">Nombre</label>
                                        <input type="text" class="form-control" id="nombre" placeholder="Ingrese el nombre..." style="border-radius:8px; background:#ffffff; border:none; color:black; font-size:1.1rem;">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="contacto" class="form-label" style="font-size:1.3rem;">Contacto</label>
                                        <input type="text" class="form-control" id="contacto" placeholder="Ingrese el contacto..." style="border-radius:8px; background:#ffffff; border:none; color:black; font-size:1.1rem;">
                                    </div>
                                </div>
                                <div class="mb-4">
                                    <label for="direccion" class="form-label" style="font-size:1.3rem;">Dirección</label>
                                    <textarea class="form-control" id="direccion" placeholder="Agregar la dirección del proveedor..." rows="3" style="border-radius:10px; background:#ffffff; border:none; color:black; font-size:1rem;"></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer d-flex justify-content-center border-0">
                            <button type="button" class="btn btn-danger px-4 me-3" data-bs-dismiss="modal" style="border-radius:8px; border: solid white 1px; font-size:1.13rem; font-weight:500;">
                                <i class="bi bi-x-circle me-2"></i>Cancelar
                            </button>
                            <button type="button" class="btn btn-dark px-4" style="border:1px solid #bbb; border-radius:8px; border: solid white 1px; font-size:1.13rem; font-weight:500;">
                                <i class="bi bi-save me-2"></i>Guardar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Table Section -->
    <section class="table-section">
        <div class="card table-card">
            <div class="card-header table-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="table-title mb-0">Tabla de Proveedor</h5>
                    <div class="pagination-info d-flex align-items-center gap-2">
                        <span class="pagination-text">Página:</span>

                        @* Página anterior *@
                        <form method="get" asp-action="Index" style="display:inline;">
                            <input type="hidden" name="numeroPagina" value="@(Model.PageNumber - 1)" />
                            @* Mantener filtros en la query string si vienen *@
                            @if (Context.Request.Query.ContainsKey("filtros.Nombre"))
                            {
                                <input type="hidden" name="filtros.Nombre" value="@Context.Request.Query["filtros.Nombre"]" />
                            }
                            <button type="submit" class="btn btn-pagination" @(Model.PageNumber <= 1 ? "disabled" : "")>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                        </form>

                        <span class="page-number fw-bold">@Model.PageNumber</span>

                        @* Página siguiente *@
                        <form method="get" asp-action="Index" style="display:inline;">
                            <input type="hidden" name="numeroPagina" value="@(Model.PageNumber + 1)" />
                            @if (Context.Request.Query.ContainsKey("filtros.Nombre"))
                            {
                                <input type="hidden" name="filtros.Nombre" value="@Context.Request.Query["filtros.Nombre"]" />
                            }
                            <button type="submit" class="btn btn-pagination" @(Model.PageNumber >= Model.TotalPages ? "disabled" : "")>
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    @if (!string.IsNullOrEmpty(Context.Request.Query["filtros.Nombre"]))
                    {
                        <p>Resultados para: <strong>@Context.Request.Query["filtros.Nombre"]</strong></p>
                    }

                    @if (Model.Data != null && Model.Data.Any())
                    {
                        <table class="table table-hover mb-0 suppliers-table">
                            <thead class="table-dark">
                                <tr>
                                    <th>Id Proveedor</th>
                                    <th>Nombre</th>
                                    <th>Contacto</th>
                                    <th>Dirección</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var proveedor in Model.Data)
                                {
                                    <tr>
                                        <td>@proveedor.IdProveedor</td>
                                        <td>@proveedor.Nombre</td>
                                        <td>@proveedor.Contacto</td>
                                        <td>@proveedor.Direccion</td>
                                        <td class="actions-cell">
                                            <a asp-action="Edit" asp-route-id="@proveedor.IdProveedor" class="btn btn-action btn-edit" title="Editar">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <form asp-action="Delete" asp-route-id="@proveedor.IdProveedor" method="post" class="d-inline" onsubmit="return confirm('¿Está seguro que desea eliminar este proveedor?');">
                                                <button type="submit" class="btn btn-action btn-delete" title="Eliminar">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    }
                    else
                    {
                        <div class="p-3 text-center">No se encontraron proveedores.</div>
                    }
                </div>
            </div>
        </div>
    </section>

    <!-- Stats Cards Section -->
    <section class="stats-section mt-4">
        <div class="row">
            <div class="col-md-4">
                <div class="card stat-card">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="stat-label">Total Proveedores</h6>
                            <h2 class="stat-number">
                                @{
                                    var totalProveedores = 0;
                                    if (Model != null)
                                    {
                                        // Si tienes TotalItems
                                        // totalProveedores = Model.TotalItems;

                                        // Si no tienes TotalItems, muestra la cantidad actual de la página
                                        if (Model.Data != null)
                                        {
                                            totalProveedores = Model.TotalRecords;
                                        }
                                    }
                                }
                                @totalProveedores
                            </h2>

                        </div>
                        <div class="stat-icon-container">
                            <i class="fas fa-truck stat-icon"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card stat-card stat-card-current">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="stat-label">Página actual</h6>
                            <h2 class="stat-number">@Model.PageNumber</h2>
                        </div>
                        <div class="stat-icon-container">
                            <i class="fas fa-file-alt stat-icon"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card stat-card">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="stat-label">Total Páginas</h6>
                            <h2 class="stat-number">@Model.TotalPages</h2>
                        </div>
                        <div class="stat-icon-container">
                            <i class="fas fa-copy stat-icon"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
